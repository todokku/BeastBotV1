<html>
<head>
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="http://localhost:8080/webConfig.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script>
  //alert(commentText)
  function authenticate() {
    return gapi.auth2.getAuthInstance()
        .signIn({scope: "https://www.googleapis.com/auth/youtube.force-ssl"})
        .then(function() { console.log("Sign-in successful"); },
              function(err) { console.error("Error signing in", err); });
  }
  function loadClient() {
    gapi.client.setApiKey(API_KEY);
    return gapi.client.load("https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest")
        .then(function() { console.log("GAPI client loaded for API");
        loggedIn();
      },
              function(err) { console.error("Error loading GAPI client for API", err); });
  }
  // Make sure the client is loaded and sign-in is complete before calling this method.
  function execute(videoId) {
    return gapi.client.youtube.commentThreads.insert({
      "part": "snippet",
      "resource": {
        "snippet": {
          "videoId": videoId,
          "topLevelComment": {
            "snippet": {
              "textOriginal": "Test"
            }
          }
        }
      }
    })
        .then(function(response) {
                console.log("Response", response);
                console.log("Commented. Hopefully.")
              },
              function(err) { console.error("Execute error", err); });
  }
  gapi.load("client:auth2", function() {
    gapi.auth2.init({client_id: CLIENT_ID});
  });
  function latestVideo() {

// change to https://developers.google.com/youtube/v3/docs/channels/list
    let url  = "https://www.googleapis.com/youtube/v3/search?key=" + API_KEY +"&channelId="+ channelID +"&part=snippet,id&order=date&maxResults=1"
    fetch(url)
    .then(res => res.json())
    .then((out) => {
      console.log(out)
      execute(out.items[0].id.videoId)
    })
    .catch(err => { throw err });
  }
let counter=0;
function goBeast() {
  $("#state").html("Loop counter: " + counter);
  counter+=1;
  latestVideo()
  if(counter > 1) { return true;}
  setTimeout(goBeast, 500);
}
</script>
<style>
  #cover {
      background: black;
      background-size: cover;
      height: 100%;
      text-align: center;
      display: flex;
      align-items: center;
      position: relative;
  }

  #cover-caption {
      width: 100%;
      position: relative;
      z-index: 1;
  }

  /* only used for background overlay not needed for centering */
  form:before {
      content: '';
      height: 100%;
      left: 0;
      position: absolute;
      top: 0;
      width: 100%;
      background-color: rgba(0,0,0,0.3);
      z-index: -1;
      border-radius: 10px;
  }
li {
  color:black;
}
#card-header {
  color:black;
}
</style>
<script>
let UI_STATE = 0;

function loggedIn() {
$("#beastFeelz").text("BEAST IS HUNGRY");
$("#ytlogin").hide();
$("#fetchButton").show();
}
function fetchButtonClick() {
  $("#beastFeelz").text("RUN.");
  $("#fetchButton").hide();
  $("#beastState").show();
  $("#beastGif").show();
}
//goBeast()
</script>
</head>
<body>
  <section id="cover" class="min-vh-100">
      <div id="cover-caption">
          <div class="container">
              <div class="row text-white">
                  <div class="col-xl-8 col-lg-8 col-md-8 col-sm-10 mx-auto text-center form p-4">
                      <h1 class="display-4 py-2" id="beastFeelz">BEAST IS ASLEEP</h1>
                      <h1 id="state"></h1>
                      <img src="beast.gif" id="beastGif" class="img-fluid" style="padding:15px;display:none;" />

                      <div class="px-2">
                        <div  class="d-flex justify-content-center w-100" style="display:none;padding:15px;">
                          <div id="beastState" style="display:none" class="card" style="width: 18rem;">
                            <div class="card-header" style="color:black">
                              Beast State
                            </div>
                            <ul class="list-group list-group-flush">
                              <li class="list-group-item">Loop Count: 0 </li>
                              <li class="list-group-item">Current Latest: </li>
                              <li class="list-group-item">Status: </li>
                            </ul>
                          </div>
                        </div>

                              <div class="form-group">
                                <button id="ytlogin" class="btn btn-primary btn-lg" onclick="authenticate().then(loadClient)">Connect Youtube Account</button>
                              </div>
                              <div class="form-group">
                                  <button id="fetchButton" class="btn btn-primary btn-lg" onclick="fetchButtonClick()" style="display:none">Beast, go fetch.</button>
                              </div>

                      </div>
                  </div>
              </div>
          </div>
      </div>
  </section>




</body>
</html>
